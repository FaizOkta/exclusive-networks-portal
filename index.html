<script src="https://global.oktacdn.com/okta-auth-js/7.7.0/okta-auth-js.min.js"></script>
<script>
  /****************************************************
   * OKTA CONFIG â€“ UPDATE THESE TWO VALUES
   ****************************************************/
  const OKTA_DOMAIN = "https://demo-ocimaster.okta.com";
  const CLIENT_ID   = "0oazpnnecis3YdhQM697";

  const REDIRECT_URI = window.location.origin + window.location.pathname;
  const ISSUER = `${OKTA_DOMAIN}/oauth2/default`;

  const authClient = new OktaAuth({
    issuer: ISSUER,
    clientId: CLIENT_ID,
    redirectUri: REDIRECT_URI,
    scopes: ["openid", "profile", "email"],
    transactionManager: { storage: "sessionStorage" },
    tokenManager: { storage: "localStorage" }
  });

  /****************************************************
   * UI HELPERS
   ****************************************************/
  function showWelcome() {
    const banner = document.getElementById("welcomeMessage");
    banner.classList.add("show");
    setTimeout(() => banner.classList.remove("show"), 5000);
  }

  function updateDropdownMenu(isAuthenticated) {
    const dropdownMenu = document.getElementById("dropdownMenu");

    if (isAuthenticated) {
      dropdownMenu.innerHTML = `
        <a href="#" onclick="logout(event)">Logout</a>
      `;
    } else {
      dropdownMenu.innerHTML = `
        <a href="#" onclick="login(event)">Log in</a>
      `;
    }
  }

  /****************************************************
   * AUTH FLOW
   ****************************************************/
  async function login(event) {
    event.preventDefault();
    await authClient.signInWithRedirect({
      extraParams: { prompt: "login" }
    });
  }

  async function logout(event) {
    event.preventDefault();
    await authClient.tokenManager.clear();
    await authClient.signOut({
      postLogoutRedirectUri: window.location.origin + window.location.pathname
    });
  }

  async function init() {
    // Handle redirect back from Okta
    if (authClient.isLoginRedirect()) {
      await authClient.handleRedirect();
      window.history.replaceState({}, document.title, window.location.pathname);
      showWelcome();
    }

    const isAuthenticated = await authClient.isAuthenticated();
    updateDropdownMenu(isAuthenticated);

    // Optional: expose user info later if you want
    // if (isAuthenticated) {
    //   const user = await authClient.getUser();
    //   console.log("Logged in user:", user);
    // }
  }

  init().catch(err => {
    console.error("Auth error:", err);
    updateDropdownMenu(false);
  });
</script>
